<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<title>R lectures</title>
<meta name="author" content="(Luis G. Moyano)"/>
<style type="text/css">
.underline { text-decoration: underline; }
</style>
<link rel="stylesheet" href="../../reveal.js/css/reveal.css"/>

<link rel="stylesheet" href="../../reveal.js/css/theme/my_simple.css" id="theme"/>

<link rel="stylesheet" href="../../reveal.js/lib/css/zenburn.css"/>
<!-- If the query includes 'print-pdf', include the PDF print sheet -->
<script>
    if( window.location.search.match( /print-pdf/gi ) ) {
        var link = document.createElement( 'link' );
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = '../../reveal.js/css/print/pdf.css';
        document.getElementsByTagName( 'head' )[0].appendChild( link );
    }
</script>
<meta name="description" content="Programación en R 2017">
</head>
<body>
<div class="reveal">
<div class="slides">
<section id="sec-title-slide"><h1>R lectures</h1><h3>16/05/2017</h3>
</section>
<section>
<section id="slide-org912c8b4">
<h2 id="org912c8b4">Repaso de la clase anterior</h2>
<div class="outline-text-2" id="text-org912c8b4">
</div>
</section>
<section id="slide-orgae0d7f2">
<h3 id="orgae0d7f2">Funciones matemáticas básicas</h3>
<div class="org-src-container">

<pre><code class="R" >- exp(): función exponencial, base e
- log(): logaritmo natural 
- log10(): logaritmo base 10
- sqrt(): raiz cuadrada
- abs(): valor absoluto
- sin(), cos(), etc.: funciones trigonométricas
- min(),  max(): valor mínimo y máximo de un vector
- which.min() and which.max(): índice del valor mínimo y máximo 
- pmin() and pmax(): mínimos y máximos para varios vectores, por elemento
- sum() and prod(): suma y producto de elementos de vectores
- cumsum() and cumprod(): suma acumulada y producto acumulado de elementos de vectores
- round(), floor(), and ceiling(): redondeo al entero más próximo, al menor o al mayor, respectivamente
- factorial(): función factorial
- %%: operador módulo y %/%: operador división por enteros
</code></pre>
</div>
</section>
<section id="slide-org1ce33ff">
<h3 id="org1ce33ff">Cálculo</h3>
<ol>
<li>R tiene capacidades tanto para hacer cálculos numéricos como analíticos:</li>
<li>Existen paquetes para ecuaciones diferenciales (<code>odesolve</code>), y para extender la capacidad simbólica usando el sistema Yacas (<code>ryacas</code>). Ver CRAN.</li>

</ol>
</section>
<section id="slide-org8101132">
<h3 id="org8101132">Álgebra Lineal</h3>
<ol>
<li>Multiplicación de matrices - operador <code>%*%</code></li>
<li>Sistema de ecuaciones lineales (o invertir una matriz) con <code>solve()</code></li>
<li>Autovectores y autovalores - <code>eigen()</code></li>
<li>Otras operaciones posibles <code>t()</code>, <code>svd()</code>, etc.</li>

</ol>
</section>
<section id="slide-org57375ed">
<h3 id="org57375ed">Otros paquetes de interés</h3>
<ul>
<li><a href="https://cran.r-project.org/web/views/NumericalMathematics.html">Numerical Mathematics</a></li>
<li><a href="https://cran.r-project.org/web/views/DifferentialEquations.html">Ecuaciones diferenciales</a>
<ul>
<li>tienen también el libro "2012 - Book - Solving Differential Equations in R.pdf" en #bibliografia @slack</li>

</ul></li>
<li><a href="https://cran.r-project.org/web/views/TimeSeries.html">Series temporales</a></li>
<li><a href="https://cran.r-project.org/web/views/Optimization.html">Optimización y programación matemática</a></li>
<li>Aritmética de precisión múltiple con <a href="https://cran.r-project.org/web/packages/gmp/index.html">gmp</a></li>
<li>Paquete <a href="https://cran.r-project.org/web/packages/gsl/index.html">gsl</a>, una interface a la Biblioteca Científica GNU</li>
<li>Mil cosas más :)</li>

</ul>
</section>
</section>
<section>
<section id="slide-orgac91e2f">
<h2 id="orgac91e2f">Estadística</h2>
<div class="outline-text-2" id="text-orgac91e2f">
</div>
</section>
<section id="slide-orgccb5f8b">
<h3 id="orgccb5f8b">Estadística descriptiva</h3>
<p>
Conceptos para entender la estructura de un grupo (digamos, <code>N &gt; 30</code>) de datos. 
</p>

<p>
Una manera de hacer estadística descriptiva en columnas de listas (o data.frames) es con <code>sapply</code>:
</p>

<div class="org-src-container">

<pre><code class="R" >sapply(mydata, mean, na.rm=TRUE) 
</code></pre>
</div>

<p>
donde podemos usar <code>mean</code>, <code>sd</code>, <code>var</code>, <code>min</code>, <code>max</code>, <code>median</code>, <code>range</code>, o <code>quantile</code>, entre otras). 
</p>

<p>
O <code>summary()</code>, que es equivalente y funciona con data.frames.
</p>

<p>
Tenemos también <code>group_by() + summarise()</code> con las mismas funciones básicas.
</p>
</section>
<section id="slide-orge98da71">
<h3 id="orge98da71">Distribuciones</h3>
<p>
En general R usa la siguiente convención:
</p>

<ul>
<li><code>dDIST(x, ...)</code> es la función distribución de probabilidad (PDF). Devuelve la prob. de observar un
valor x</li>
<li><code>pDIST(x, ...)</code> es la función cumulativa de probabilidad (CDF). Devuelve la prob. de obervar un
valor menor a x (mayor si usamos <code>lower.tail=F</code>)</li>
<li><code>rDIST(n, ...)</code> es un generador de números aleatorios que devuelve n valores sacados de una distr. DIST.</li>
<li><code>qDIST(p, ...)</code> es la función cuartil que devuelve el x que corresponde al percentil <code>p</code> de DIST. Si
<code>lower.tail=F</code>, devuelve <code>1</code> menos <code>p</code>.</li>

</ul>

<img style="WIDTH:1200px; HEIGHT:200px; border:0" src="./figs/dists.png">

<p>
Para ver las distribuciones disponibles, ver el <a href="https://cran.r-project.org/web/views/Distributions.html">task view de distribuciones</a>
</p>
</section>
<section id="slide-org6a2efd9">
<h4 id="org6a2efd9">Distribución Normal</h4>
<p>
Construyo una figura de la función normal usando un vector entre -5 y 5 con 100 puntos.
</p>

<div class="org-src-container">

<pre><code class="R" >library(ggplot2)
set.seed(8888) ## elijo la semilla para poder "controlar" la aleatoridad
x <- seq(from=-5, to=5, length.out=100) # el intervalo [-5 5]
f <- dnorm(x) # normal con media 0 y sd 1 
ggplot(data.frame(col1=x, col2=f), aes(x=col1, y=col2)) + geom_line()
</code></pre>
</div>
</section>
<section id="slide-orgccb5167">
<h4 id="orgccb5167">Otras distribuciones</h4>
<p>
Construyo un vector de 10^5 puntos que contenga valores estocásticos extraidos de una dist. Binomial
de <code>n=5</code> (número de intentos) y <code>p=0.5</code> (probabilidad de éxito).
</p>

<div class="org-src-container">

<pre><code class="R" >x <- rbinom(100000,5,0.5)
mean(x)
# [1] 2.5004

mean(x[x<=4])
# [1] 2.418766
</code></pre>
</div>
</section>
</section>
<section>
<section id="slide-org893c89f">
<h2 id="org893c89f">Modelado estadístico</h2>
<p>
Modelado se refiere a proponer determinadas relaciones entre variables, típicamente cuál es la
relación entre una variable dependiente o <i>variable respuesta</i> y otras variables independientes o
<i>variables explicativas</i>. 
</p>

<p>
En R la función <code>lm()</code> se usa para regresión lineal (<i>linear models</i>) y <code>glm()</code> para <i>generalized linear models</i>.
</p>
</section>
<section id="slide-org1ad6ab8">
<h4 id="org1ad6ab8">Regresión lineal - <code>lm()</code></h4>
<p>
Construimos un "modelo" (una relación) entre variables dependientes e independientes optimizando
parámetros para poder predecir.
</p>

<p>
1 - Propongo una determinada relación de variables.
</p>


<p>
2 - Calculo coeficientes del modelo.
</p>


<p>
3 - Compruebo que tan bien se ajusta el modelo a nuevas observaciones.
</p>

<div class="org-src-container">

<pre><code class="R" >y[i] ~ f(x[i,]) = b[1] x[i,1] + ... b[n] x[i,n]
## b[i] son los coeficientes o betas
</code></pre>
</div>

</section>
<section id="slide-org3180035">
<h4 id="org3180035">Ejemplo con datos de <code>2011 US Census PUMS</code></h4>
<p>
Pueden bajar los datos de <a href="https://github.com/WinVector/zmPDSwR/raw/master/PUMS/psub.RData">acá</a>.
</p>

<div class="org-src-container">

<pre><code class="R" >## hacemos la regresión:
load("psub.RData")
dtrain <- subset(psub, ORIGRANDGROUP >= 500)
dtest  <- subset(psub, ORIGRANDGROUP < 500)
model  <- lm(log(PINCP,base=10) ~ AGEP + SEX + COW + SCHL, data=dtrain) 
dtest$predLogPINCP <- predict(model,newdata=dtest) 

## resultados:
summary(model)

## graficamos:
library(ggplot2)
ggplot(data=dtest,aes(x=predLogPINCP,y=log(PINCP,base=10))) + geom_point(alpha=0.2,color="black") + 
geom_smooth(aes(x=predLogPINCP, y=log(PINCP,base=10)),color="black") +
geom_line(aes(x=log(PINCP,base=10), y=log(PINCP,base=10)),color="blue",linetype=2) +
scale_x_continuous(limits=c(4,5)) +
scale_y_continuous(limits=c(3.5,5.5))

## residuos:
ggplot(data=dtest,aes(x=predLogPINCP, y=predLogPINCP-log(PINCP,base=10))) +
geom_point(alpha=0.2,color="black") +
geom_smooth(aes(x=predLogPINCP, y=predLogPINCP-log(PINCP,base=10)), color="black")

</code></pre>
</div>
</section>
<section id="slide-org9671bd7">
<h4 id="org9671bd7">Regresión lineal generalizada - <code>glm()</code></h4>
<p>
Los modelos lineales asumen que el valor predicho es continuo y que los errores van a ser
"normales". Los modelos lineales generalizados relajan estas suposiciones.
</p>

<div class="org-src-container">

<pre><code class="R" >## expresión general
glm(formula, family=familytype(link=linkfunction), data=)
</code></pre>
</div>

<p>
Ejemplito: Regresión logística, para variables categóricas.
</p>

<div class="org-src-container">

<pre><code class="R" ># F es un factor binario
# x1, x2 y x3 son predictores continuos 
fit <- glm(F~x1+x2+x3,data=mydata,family=binomial())
summary(fit) # resultados
exp(coef(fit)) # coeficientes
predict(fit, type="response") # predicciones
residuals(fit, type="deviance") # residuos 

</code></pre>
</div>
</section>
</section>
<section>
<section id="slide-orge07445f">
<h2 id="orge07445f">Estadística avanzada - material infinito</h2>
<ul>
<li><a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/00Index.html">Paquete stats</a></li>
<li><a href="https://cran.r-project.org/web/views/Distributions.html">CRAN view de distribuciones</a></li>
<li><a href="https://www.stats.ox.ac.uk/pub/MASS4/">Modern Applied Statistics with S. Fourth Edition</a> - <a href="https://cran.r-project.org/web/packages/MASS/index.html">(MASS book)</a></li>
<li><a href="http://statweb.stanford.edu/~tibs/ElemStatLearn/">The elements of statistical learning</a> - <a href="https://cran.r-project.org/web/packages/ElemStatLearn/index.html">(ElemStatLearn book)</a></li>

</ul>
</section>
</section>
<section>
<section id="slide-org5ab7df7">
<h2 id="org5ab7df7">Práctica 11</h2>
<ul>
<li>1. Generar un conjunto de 300 números aleatorios sacados de una distribución <code>lognormal</code> con media 5 y variación estándar 1. Con ellos, hacer un histograma (normalizado, vean como usar el argumento ..density..) con <code>ggplot2</code> y poner puntos de la función analítica <code>lognormal</code> &#x2014;con parámetros (5,1)&#x2014; en la misma figura para comparar (a ojo). Agregar un segundo histograma, esta vez de un millón de números (que queden dos histogramas y una curva). Pueden usar el argumento <i>alpha</i> para poder distinguir los histogramas.</li>

</ul>


<ul>
<li>2. En los datos de diamantes, hacer una regresión lineal de la variable logaritmo del precio como
función del logaritmo del peso (<code>carat</code>). Sacar los coeficientes y usarlos para graficar el modelo (con
una línea) sobre el scatterplot (usar <code>geom_hex()</code> para este último). Luego graficar los residuos
en otro gráfico.</li>

</ul>

</section>
<section id="slide-orga4c8866">
<h3 id="orga4c8866">Práctica 11 bis</h3>
<ol>
<li><p>
i)  Bajarse el Quijote de <a href="http://www.gutenberg.org">"Project Gutenberg"</a> en formato texto.
</p>

<p>
ii) Meter el libro en un vector de tipo "character", una palabra en cada elemento del
vector. Tip: <code>stringr::str_split()</code>. Cuántas palabras hay en total? Cuántas únicas?
</p>

<p>
iii) Cuántas veces aparece cada palabra (frecuencia)? Cuál es la 1er palabra del ranking? Cuánto aparece "Quijote" y en que ranking?
</p>

<p>
iv) Hacer un plot del ranking vs. frecuencia. Poner ambos ejes logarítmicos. Qué llama la atención?
</p>

<p>
v) <code>PhD</code> Qué función de distribución describiría bien lo que encontramos? Puede ser una normal? (Tip: poner "quijote distribution" en Google Scholar.) Cuánto valen los parámetros de la distribución?
</p></li>

</ol>
</section>
</section>
</div>
</div>
<p> @luisgmoyano </p>
<script src="../../reveal.js/lib/js/head.min.js"></script>
<script src="../../reveal.js/js/reveal.js"></script>

<script>
// Full list of configuration options available here:
// https://github.com/hakimel/reveal.js#configuration
Reveal.initialize({

controls: true,
progress: true,
history: false,
center: true,
slideNumber: 'c',
rollingLinks: false,
keyboard: true,
overview: true,
margin: 0.10,
minScale: 0.50,
maxScale: 2.50,

theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
transition: Reveal.getQueryHash().transition || 'slide', // default/cube/page/concave/zoom/linear/fade/none
transitionSpeed: 'fast',
multiplex: {
    secret: '', // null if client
    id: '', // id, obtained from socket.io server
    url: '' // Location of socket.io server
},

// Optional libraries used to extend on reveal.js
dependencies: [
 { src: '../../reveal.js/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }]
});
</script>
</body>
</html>
