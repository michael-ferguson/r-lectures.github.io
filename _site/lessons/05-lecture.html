<!DOCTYPE html>
<html>

    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Clase 5</title>
    <meta name="description" content="Programación y análisis de datos en R con aplicaciones científicas
">

    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="http://localhost:4000/lessons/05-lecture.html">
    <!-- <link rel="alternate" type="application/rss+xml" title="Programación en R - 2017" href="http://localhost:4000/feed.xml" /> -->
    <script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js"></script>
</head>


    <body>

        <header id="header" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <a href="/index.html" class="navbar-brand">Programación en R - 2017</a>
      <div class="navbar-header">
        <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
      </div>

      <div class="collapse navbar-collapse">
        <ul class="nav navbar-nav">
	  
	  
	  
	  
	  <li><a href="http://localhost:4000/lessons/" >Clases</a></li>
	  
	  
	  
	  
	  
	  <li><a href="http://localhost:4000/resources.html" >Biblio</a></li>
	  
	  
	  
	  
	  
	  <li><a href="http://localhost:4000/datasets.html" >Data</a></li>
	  
	  
	  
	  
	  
	  

	      <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/01-lecture.html">Clase 1 - Intro</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/01-midterm-exam.html">Parcial 1</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/01-midterm-practice.html">Práctica para recuperatorio</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/01b-midterm-exam.html">Recuperatorio Parcial 1</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/02-lecture.html">Clase 2</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/02-midterm-practice.html">Práctica para segundo parcial</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/03-lecture.html">Clase 2</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/04-lecture.html">Clase 4</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/05-lecture.html">Clase 5</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/06-lecture.html">Clase 6</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/07-lecture.html">Clase 7</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/08-lecture.html">Clase 8</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/09-lecture.html">Clase 9</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/">index</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/11-lecture.html">Clase 11</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/12-lecture.html">Clase 12</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/13-lecture.html">Clase 13</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/14-lecture.html">Clase 14</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/15-lecture.html">Clase 15</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/10-lecture.html">Clase 10</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/lessons/">Clases - index</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/posts.html">Posts</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/datasets.html">Datos</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/resources.html">Biblio</a></li> -->
              <!--  -->
              <!--  -->
              <!--  -->
              <!-- <li><a href="/about.html">Sobre el curso</a></li> -->
              <!--  -->
              <!--  -->
        </ul>
	<ul class="nav navbar-nav navbar-right">
	  
	  
	  <li><a href="http://localhost:4000/about.html" >Sobre la materia</a></li>
	</ul>

        </div><!-- /.navbar-collapse -->
    </div>
</header>

<style>
  .bottom-three {
     margin-bottom: 2cm;
  }
</style>


<p class="bottom-three">
</p>
<!-- <div class="site-banner"> -->
<!--     <img src="/images/banner.jpg"></img> -->
<!-- </div> -->



        <div class="site-content container">
            <div class="col-md-9">
                <h1 id="repaso-de-la-clase-anterior">repaso de la clase anterior</h1>

<h2 id="lecturaescritura">lectura/escritura</h2>

<p>“read_csv()” lee un archivo delimitado por comas.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>read_csv(readr_example("mtcars.csv"))
read_csv(readr_example("mtcars.csv.zip"))
read_csv(readr_example("mtcars.csv.bz2"))
read_csv("https://github.com/tidyverse/readr/raw/master/inst/extdata/mtcars.csv")
</code></pre>
</div>

<p>Se pueden controlar cosas como col_types, col_names, delim, skip, n_max, y otros.</p>

<p>Existe una “write_csv” equivalente.</p>

<h2 id="piping--con--magrittr-y-operador-"><em>Piping</em>  con  <em>Magrittr</em> y operador %&gt;%</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>x %&gt;% f en vez de f(x) # el valor de x se direcciona a f()

x %&gt;% f(., arg2, arg3) # por default pasa al 1er argumento
x %&gt;% f(arg2, arg3)    # por lo tanto, puede obviarse el punto
x %&gt;% f(arg1, ., arg3) # puede usarse el punto para direccionar a otro lado

mean_by_state %&gt;% # mi data.frame
mutate(frac = mean/overall_mean) %&gt;% # creo la columna frac
filter(frac &gt;= 1) %&gt;% # filtro la columna frac
arrange(desc(frac)) # ordeno de mayor a menor
</code></pre>
</div>

<h2 id="combinando-dataframes-sin-llaves">combinando data.frames (sin llaves)</h2>

<p><img src="./figs/binds.png" /></p>

<h2 id="combinando-dataframes-con-llaves">combinando data.frames (con llaves)</h2>

<p><img style="WIDTH:500px; HEIGHT:420px; border:0" src="./figs/joins.png" /></p>

<p><img style="position:absolute; TOP:100px; LEFT:750px; WIDTH:400px; HEIGHT:150px; border:0" src="./figs/sets.png" /></p>

<ul>
  <li>miren con cuidado el cheat-sheet de dplyr</li>
</ul>

<h1 id="repaso-práctica-4">repaso práctica 4</h1>

<ol class="smallfont">
  <li>Entrar en Buenos Aires Data (ver link en la web del curso)</li>
  <li>Ir a datos de Contaminación sonora </li>
  <li>Bajar csv's de Torres y Mediciones 2011, 2012 y 2013 </li>
  <li>Cargar todo en R </li>
  <li>Hacer un gran data.frame con TMI y las tres mediciones</li>
  <li>Cuales son los 5 barrios en donde hay más (menos) promedio energético hora?</li>
  <li>Cómo se comparan los valores extremos con la media de todos los barrios?</li>
</ol>

<h2 id="hacer-gran-dataframe-gran">hacer gran-dataframe-gran</h2>

<div class="highlighter-rouge"><pre class="highlight"><code>library(dplyr)
library(readr)
tmi &lt;- read_csv("~/Downloads/torres-de-monitoreo-inteligente.csv")
## Parsed with column specification:
## cols(
##   TMI = col_integer(),
##   BARRIO = col_character(),
##   DIRECCION = col_character()
## )
## &gt; tmi
## # A tibble: 16 × 3
##      TMI            BARRIO                 DIRECCION
##    &lt;int&gt;             &lt;chr&gt;                     &lt;chr&gt;
## 1   1282         Mataderos        Av. Eva Perón 5251
## 2   1283           Liniers   Lisandro de la Torre 39
## 3   1284   Vélez Sarsfield          Av. Segurola 726
m2011 &lt;- read_csv2("~/Downloads/mediciones-2011.csv")
m2012 &lt;- read_csv2("~/Downloads/mediciones-2012.csv")
m2013 &lt;- read_csv2("~/Downloads/mediciones-2013.csv")

# construyo data.frame
ruido_bsas &lt;- bind_rows(m2011, m2012, m2013)
ruido_bsas &lt;- left_join(ruido_bsas, tmi)
</code></pre>
</div>

<h2 id="ruidosos-tranquilos">Ruidosos? Tranquilos?</h2>

<div class="highlighter-rouge"><pre class="highlight"><code># 5 barrios más (menos) ruidosos
ruido_barrios &lt;- ruido_bsas %&gt;% 
group_by(BARRIO) %&gt;% 
summarise(ruido_avg = mean(PROMEDIO_ENERGETICO_HORA, na.rm = TRUE)) %&gt;% 
arrange(desc(ruido_avg)) 
# pregunta: de dónde viene el NA? (Assumptions...)

ruido_barrios %&gt;% head(n=5) # o tail(n=5) para ver los menos ruidosos
</code></pre>
</div>

<h2 id="extremos-vs-media">Extremos vs. media?</h2>

<div class="highlighter-rouge"><pre class="highlight"><code># como se comparan los valores extremos y la media
ruido_barrios %&gt;% summary # o más elegante: ruido_barrios %&gt;% select(ruido_avg) %&gt;% summary

## también funciona esto:
## ruido_barrios %&gt;% summarise(mean(ruido_avg))
## ruido_barrios %&gt;% summarise(max(ruido_avg))
## ruido_barrios %&gt;% summarise(min(ruido_avg))

59.79/70.49
# [1] 0.8482054
74.94/70.49
# [1] 1.06313
</code></pre>
</div>

<h1 id="rstudio">RStudio</h1>

<ul>
  <li>
    <p>Working directory / Workspace</p>

    <div class="highlighter-rouge"><pre class="highlight"><code>getwd() # para saber donde estoy
setwd("path/to/dir") # para decirle donde quiero estar
</code></pre>
    </div>
  </li>
  <li>Proyectos: Conjunto de archivos que van juntos: miproyecto.Rproj, .RData, .Rsession, etc</li>
  <li>Cómo grabo lo que hago?</li>
</ul>

<ol class="smallfont">
  <li>abrir un proyecto nuevo y grabar después</li>
  <li>grabar en algún directorio y después decirle que haga un proyecto ahí</li>
  <li>sin proyectos, gestionar todo uno mismo (no muy recomendado)</li>
</ol>

<div class="NOTES">
-   &lt;https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects&gt;
-   Usen atajos de teclado! Ver machete de RStudio (cheatsheet) en Slack

</div>

<h1 id="funciones">Funciones</h1>

<div class="NOTES">
Una función tiene como propósito encapsular y automatizar tareas que se repetirón, posiblemente 
sobre objetos distintos cada vez. Por ejemplo, la función \`read\_csv\` o \`plot\` contiene código que no
querríamos escribir cada vez que queremos cargar datos de un archivo csv o hacer un gráfico. A su
vez, con ellas podemos cargar datos de cualquier archivo csv o hacer cualquier gráfico.

Más información en &lt;http://r4ds.had.co.nz/functions.html&gt;.

</div>

<h2 id="anatomía-de-f">anatomía de f()</h2>

<div class="highlighter-rouge"><pre class="highlight"><code># mi función se llama alta_funcion, con dos argumentos
alta_funcion &lt;- function(arg1 = 10, arg2 = TRUE, ...){

  # acá empieza mi código
  library(paquete_externo)
  x &lt;- funcion_externa(arg_ext = arg1) 
  ...
  alto código
  código y más código
  ...
  alto_resultado &lt;- mansa_funcion(arg2) # genero alto_resultado

  return(alto_resultado) # devuelvo alto resultado
}

# llamo a mi función de distintas maneras
x_default &lt;- alta_funcion() # uso arg1 = 10 y arg2 = TRUE
x_100_F   &lt;- alta_funcion(100, FALSE)
x_200_T   &lt;- alta_funcion(200, TRUE)
mi_var    &lt;- alta_funcion(arg2 = FALSE, arg_ext = 10.2) # uso arg1 = 10
</code></pre>
</div>

<h2 id="ejemplo">ejemplo</h2>

<div class="highlighter-rouge"><pre class="highlight"><code># función que normaliza de dos maneras distintas un vector de valores 
normaliza_vector &lt;- function(vector = c(10, 9, 8, 7, 6), square_root = FALSE){

    if(square_root == TRUE) N &lt;- sum(vector^2)^(1/2)
    else                    N &lt;- sum(vector)/length(vector) # ojo, da error si vector está vacio

    if(N != 0) return(vector/N)
    else print("error: Norma igual a cero!")
}

# distintas maneras de llamar la función
normaliza_vector() # con los argumentos por default
# [1] 1.250 1.125 1.000 0.875 0.750
x &lt;- c(10, 9, 8, 7 , 6) # c() es una función que toma N argumentos y devuelve un vector
normaliza_vector(x) # haciendo explícito el vector
# [1] 1.250 1.125 1.000 0.875 0.750
y &lt;- c(1, 2, 3)
normaliza_vector(y) # un vector diferente
# [1] 0.5 1.0 1.5
normaliza_vector(y, TRUE) # usando la norma euclidiana
# [1] 0.2672612 0.5345225 0.8017837
</code></pre>
</div>

<div class="NOTES">
La idea de las funciones es que vamos escribiendo código y que, cuando funciona, lo metemos dentro
de la función. Luego se puede ir extendiendo a medida que se va necesitando (por ejemplo, agregando
argumentos, etc). 

Es más fácil escribir una función a partir de código que ya sabemos que funciona que sentarse a
escribir una función de cero.

</div>

<h1 id="práctica-5">Práctica 5</h1>

<ol>
  <li>Trabajamos sobre datos de ruido de Buenos Aires Data. Escribir una función que devuelva el min,
máx y promedio (mean) del ruido dependiendo del barrio.</li>
  <li>Porqué obtengo un <code class="highlighter-rouge">NA</code> en los resultados de la práctica 4?
    <ol>
      <li>Usar lo aprendido sobre joins para no tener este <code class="highlighter-rouge">NA</code>.</li>
    </ol>
  </li>
  <li>Cómo puedo mejorar la columna FECHA de la práctica 3? Consejo: usar el paquete <code class="highlighter-rouge">stringr</code> más <code class="highlighter-rouge">tidyr::separate</code>.</li>
  <li>Cuál es la hora de mayor ruido del día? Cuál es el dia más ruidoso de la semana? Hay algún barrio
con más ruido el fin de semana que el resto?</li>
</ol>


            </div>
            <div id="site-side-bar" class="col-md-3">
                <div id="navigation">
    <!-- <div class="panel panel-default"> -->
    <!--     <\!-- <div class="panel-heading">Social Media</div> -\-> -->
    <!--     <div class="panel-body"> -->
    <!--         <ul class="nav"> -->
    <!--              -->
    <!--             <li> -->
    <!--                 <a href="https://github.com/lgmoyano"> -->
    <!--                     <span class="icon  icon--github"> -->
    <!--                         <svg viewBox="0 0 16 16"> -->
    <!--                             <path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/> -->
    <!--                         </svg> -->
    <!--                     </span> -->

    <!--                     <span class="username">lgmoyano</span> -->
    <!--                 </a> -->
    <!--             </li> -->
    <!--              -->
    <!--              -->
    <!--             <li> -->
    <!--                 <a href="https://twitter.com/@luisgmoyano"> -->
    <!--                     <span class="icon  icon--twitter"> -->
    <!--                         <svg viewBox="0 0 16 16"> -->
    <!--                             <path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809 -->
    <!--                             c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/> -->
    <!--                         </svg> -->
    <!--                     </span> -->

    <!--                     <span class="username">@luisgmoyano</span> -->
    <!--                 </a> -->
    <!--             </li> -->
    <!--              -->
    <!--         </ul> -->
    <!--     </div> -->
    <!-- </div> -->

    <!-- <div class="panel panel-default"> -->
    <!--     <div class="panel-heading">Archivo</div> -->
    <!--     <div class="panel-body"> -->
    <!--          -->

    <!--         <ul class="nav"> -->
    <!--              -->
    <!--             <li class="archive-entry"> -->
    <!--                 <a href="javascript:void(0)">Apr 2017 <span class="badge pull-right">2</span></a> -->
    <!--                 <ul> -->
    <!--                      -->
    <!--                     <li><a href="/2017/04/05/simple.html">using types effectively</a></li> -->
    <!--                      -->
    <!--                     <li><a href="/2017/04/05/simple.html">Simple</a></li> -->
    <!--                      -->
    <!--                 </ul> -->
    <!--             </li> -->
    <!--              -->
    <!--             <li class="archive-entry"> -->
    <!--                 <a href="javascript:void(0)">Aug 2015 <span class="badge pull-right">2</span></a> -->
    <!--                 <ul> -->
    <!--                      -->
    <!--                     <li><a href="/haskell/2015/08/30/hello-world-in-haskell.html">hello world in haskell</a></li> -->
    <!--                      -->
    <!--                     <li><a href="/jekyll/update/2015/08/29/welcome-to-jekyll.html">Welcome to Jekyll!</a></li> -->
    <!--                      -->
    <!--                 </ul> -->
    <!--             </li> -->
    <!--              -->
    <!--             <li class="archive-entry"> -->
    <!--                 <a href="javascript:void(0)">Jan 2015 <span class="badge pull-right">4</span></a> -->
    <!--                 <ul> -->
    <!--                      -->
    <!--                     <li><a href="/jekyll/update/2015/01/07/dummy-post-2.html">dummy 2</a></li> -->
    <!--                      -->
    <!--                     <li><a href="/2015/01/06/dummy-post-2.html">Programación en R</a></li> -->
    <!--                      -->
    <!--                     <li><a href="/2015/01/06/dummy-post-2.html">Dummy Post 2</a></li> -->
    <!--                      -->
    <!--                     <li><a href="/2015/01/06/dummy-post-1.html">Programación en R</a></li> -->
    <!--                      -->
    <!--                 </ul> -->
    <!--             </li> -->
    <!--              -->
    <!--         </ul> -->
    <!--     </div> -->
    <!-- </div> -->

</div>


            </div>
        </div>

        <!-- <p><a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="position:absolute;RIGHT:10px; TOP:550px; border-width:0" src="by-nc.png" height="20" width="95"/></a></p> -->


    </body>

</html>
